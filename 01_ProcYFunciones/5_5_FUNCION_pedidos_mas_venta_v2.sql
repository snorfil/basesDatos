use negocios2011
-- no funciona el MAX 
go
alter FUNCTION DBO.PEDIDOMAXVENTA() RETURNS INT
BEGIN
DECLARE @PEDIDO INT
DECLARE @TOTAL DECIMAL(10,2)
select @TOTAL = MAX( 
SELECT  sum(PD.PRECIOUNIDAD*PD.CANTIDAD) 
FROM dbo.PEDIDOSDETA PD
GROUP BY pd.IDPEDIDO)


SELECT  @PEDIDO = PD.IDPEDIDO
FROM dbo.PEDIDOSDETA PD
GROUP BY pd.IDPEDIDO
having  SUM(PD.PRECIOUNIDAD*PD.CANTIDAD) =@TOTAL

RETURN @PEDIDO
END
GO

SELECT DBO.PEDIDOMAXVENTA()

